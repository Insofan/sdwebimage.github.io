<!DOCTYPE html>
<html lang="en">
  <head>
    <title>SDWebImagePhotosPlugin  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="SDWebImagePhotosPlugin  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">SDWebImagePhotosPlugin 0.4.0 Docs</a> (57% documented)</p>
        <p class="header-right"><a href="https://github.com/SDWebImage/SDWebImagePhotosPlugin"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">SDWebImagePhotosPlugin Reference</a>
        <img id="carat" src="img/carat.png" />
        SDWebImagePhotosPlugin  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Categories.html">Categories</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Categories/NSURL%28SDWebImagePhotosPlugin%29.html">NSURL(SDWebImagePhotosPlugin)</a>
              </li>
              <li class="nav-group-task">
                <a href="Categories/PHImageRequestOptions%28SDWebImagePhotosPlugin%29.html">PHImageRequestOptions(SDWebImagePhotosPlugin)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/SDWebImagePhotosLoader.html">SDWebImagePhotosLoader</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Constants.html">Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Constants.html#/c:@SDWebImagePhotosErrorDomain">SDWebImagePhotosErrorDomain</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@SDWebImagePhotosLoaderPixelSize">SDWebImagePhotosLoaderPixelSize</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@SDWebImagePhotosLoaderPointSize">SDWebImagePhotosLoaderPointSize</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@SDWebImagePhotosPluginVersionNumber">SDWebImagePhotosPluginVersionNumber</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@SDWebImagePhotosPluginVersionString">SDWebImagePhotosPluginVersionString</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@SDWebImagePhotosProgressExpectedSize">SDWebImagePhotosProgressExpectedSize</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@SDWebImagePhotosScheme">SDWebImagePhotosScheme</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/SDWebImagePhotosError.html">SDWebImagePhotosError</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='sdwebimagephotosplugin' class='heading'>SDWebImagePhotosPlugin</h1>

<p><a href="https://travis-ci.org/SDWebImage/SDWebImagePhotosPlugin"><img src="https://img.shields.io/travis/SDWebImage/SDWebImagePhotosPlugin.svg?style=flat" alt="CI Status"></a>
<a href="https://cocoapods.org/pods/SDWebImagePhotosPlugin"><img src="https://img.shields.io/cocoapods/v/SDWebImagePhotosPlugin.svg?style=flat" alt="Version"></a>
<a href="https://cocoapods.org/pods/SDWebImagePhotosPlugin"><img src="https://img.shields.io/cocoapods/l/SDWebImagePhotosPlugin.svg?style=flat" alt="License"></a>
<a href="https://cocoapods.org/pods/SDWebImagePhotosPlugin"><img src="https://img.shields.io/cocoapods/p/SDWebImagePhotosPlugin.svg?style=flat" alt="Platform"></a>
<a href="https://github.com/SDWebImage/SDWebImagePhotosPlugin"><img src="https://img.shields.io/badge/Carthage-compatible-brightgreen.svg?style=flat" alt="Carthage compatible"></a>
<a href="https://swift.org/package-manager/"><img src="https://img.shields.io/badge/SwiftPM-compatible-brightgreen.svg?style=flat" alt="SwiftPM compatible"></a>
<a href="https://codecov.io/gh/SDWebImage/SDWebImagePhotosPlugin"><img src="https://codecov.io/gh/SDWebImage/SDWebImagePhotosPlugin/branch/master/graph/badge.svg" alt="codecov"></a></p>
<h2 id='what-39-s-for' class='heading'>What&rsquo;s for</h2>

<p>SDWebImagePhotosPlugin is a plugin for <a href="https://github.com/rs/SDWebImage/">SDWebImage</a> framework, which provide the image loading support for <a href="https://developer.apple.com/documentation/photokit">Photos Library</a>.</p>

<p>By using this plugin, it allows you to use your familiar View Category method from SDWebImage, to load Photos image with <code>PHAsset</code> or <code>localIdentifier</code>.</p>
<h2 id='requirements' class='heading'>Requirements</h2>

<ul>
<li>iOS 8+</li>
<li>macOS 10.13+</li>
<li>tvOS 10+</li>
<li>Xcode 10+</li>
</ul>
<h2 id='installation' class='heading'>Installation</h2>
<h4 id='cocoapods' class='heading'>CocoaPods</h4>

<p>SDWebImagePhotosPlugin is available through <a href="https://cocoapods.org">CocoaPods</a>. To install
it, simply add the following line to your Podfile:</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'SDWebImagePhotosPlugin'</span>
</code></pre>
<h4 id='carthage' class='heading'>Carthage</h4>

<p>SDWebImagePhotosPlugin is available through <a href="https://github.com/Carthage/Carthage">Carthage</a>.</p>
<pre class="highlight plaintext"><code>github "SDWebImage/SDWebImagePhotosPlugin"
</code></pre>
<h4 id='swift-package-manager-xcode-11' class='heading'>Swift Package Manager (Xcode 11+)</h4>

<p>SDWebImagePhotosPlugin is available through <a href="https://swift.org/package-manager">Swift Package Manager</a>.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/SDWebImage/SDWebImagePhotosPlugin.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"0.3"</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre>
<h2 id='usage' class='heading'>Usage</h2>

<p><strong>Important!</strong> To use Photos Library plugin. Firstly you need to register the photos loader to image manager.</p>

<p>There are two ways to register the photos loader. One for temporarily usage (when providing URL is definitely Photos URL but not HTTP URL), and another for global support (don&rsquo;t need any check, support both HTTP URL as well as Photos URL).</p>
<h4 id='use-custom-manager-temporarily' class='heading'>Use custom manager (temporarily)</h4>

<p>You can create custom manager for temporary usage. When you use custom manager, be sure to specify <code>SDWebImageContextCustomManager</code> context option with your custom manager for View Category methods.</p>

<ul>
<li>Objective-C</li>
</ul>
<pre class="highlight plaintext"><code>// Assign loader to custom manager
SDWebImageManager *manager = [[SDWebImageManager alloc] initWithCache:SDImageCache.sharedImageCache loader:SDWebImagePhotosLoader.sharedLoader];
</code></pre>

<ul>
<li>Swift</li>
</ul>
<pre class="highlight swift"><code><span class="c1">// Assign loader to custom manager</span>
<span class="k">let</span> <span class="nv">manager</span> <span class="o">=</span> <span class="kt">SDWebImageManager</span><span class="p">(</span><span class="nv">cache</span><span class="p">:</span> <span class="kt">SDImageCache</span><span class="o">.</span><span class="n">shared</span><span class="p">,</span> <span class="nv">loader</span><span class="p">:</span> <span class="kt">SDWebImagePhotosLoader</span><span class="o">.</span><span class="n">shared</span><span class="p">)</span>
</code></pre>
<h4 id='use-loaders-manager-globally' class='heading'>Use loaders manager (globally)</h4>

<p>You can replace the default manager&rsquo;s loader implementation using <a href="https://github.com/rs/SDWebImage/wiki/Advanced-Usage#loaders-manager">loaders manager</a> to support both HTTP &amp;&amp; Photos URL globally. Put these code just at the application launch time (or time just before <code>SDWebImageManager.sharedManager</code> initialized).</p>

<ul>
<li>Objective-C</li>
</ul>
<pre class="highlight plaintext"><code>// Supports HTTP URL as well as Photos URL globally
SDImageLoadersManager.sharedManager.loaders = @[SDWebImageDownloader.sharedDownloader, SDWebImagePhotosLoader.sharedLoader];
// Replace default manager's loader implementation
SDWebImageManager.defaultImageLoader = SDImageLoadersManager.sharedManager;
</code></pre>

<ul>
<li>Swift</li>
</ul>
<pre class="highlight swift"><code><span class="c1">// Supports HTTP URL as well as Photos URL globally</span>
<span class="kt">SDImageLoadersManager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">loaders</span> <span class="o">=</span> <span class="p">[</span><span class="kt">SDWebImageDownloader</span><span class="o">.</span><span class="n">shared</span><span class="p">,</span> <span class="kt">SDWebImagePhotosLoader</span><span class="o">.</span><span class="n">shared</span><span class="p">]</span>
<span class="c1">// Replace default manager's loader implementation</span>
<span class="kt">SDWebImageManager</span><span class="o">.</span><span class="n">defaultImageLoader</span> <span class="o">=</span> <span class="kt">SDImageLoadersManager</span><span class="o">.</span><span class="n">shared</span>
</code></pre>
<h4 id='load-images' class='heading'>Load Images</h4>

<p>To start load Photos Library image, use the <code>NSURL+SDWebImagePhotosPlugin</code> to create a Photos URL and call View Category method.</p>

<ul>
<li>Objective-C</li>
</ul>
<pre class="highlight plaintext"><code>// Create with `PHAsset`
PHAsset *asset;
NSURL *photosURL = [NSURL sd_URLWithAsset:asset];
// Create with `localIdentifier`
NSString *identifier;
NSURL *potosURL = [NSURL sd_URLWithAssetLocalIdentifier:identifier];

// Load image (assume using custom manager)
[imageView sd_setImageWithURL:photosURL placeholderImage:nil context:@{SDWebImageContextCustomManager: manager}];
</code></pre>

<ul>
<li>Swift</li>
</ul>
<pre class="highlight swift"><code><span class="c1">// Create with `PHAsset`</span>
<span class="k">let</span> <span class="nv">asset</span><span class="p">:</span> <span class="kt">PHAsset</span>
<span class="k">let</span> <span class="nv">photosURL</span> <span class="o">=</span> <span class="kt">NSURL</span><span class="o">.</span><span class="nf">sd_URL</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">asset</span><span class="p">)</span>
<span class="c1">// Create with `localIdentifier`</span>
<span class="k">let</span> <span class="nv">identifier</span><span class="p">:</span> <span class="kt">String</span>
<span class="k">let</span> <span class="nv">potosURL</span> <span class="o">=</span> <span class="kt">NSURL</span><span class="o">.</span><span class="nf">sd_URL</span><span class="p">(</span><span class="nv">withAssetLocalIdentifier</span><span class="p">:</span> <span class="n">identifier</span><span class="p">)</span>

<span class="c1">// Load image (assume using custom manager)</span>
<span class="n">imageView</span><span class="o">.</span><span class="nf">sd_setImage</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">photosURL</span><span class="p">,</span> <span class="nv">placeholderImage</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="nv">customManager</span><span class="p">:</span> <span class="n">manager</span><span class="p">])</span>
</code></pre>
<h4 id='animated-images' class='heading'>Animated Images</h4>

<p>SDWebImagePhotosPlugin supports GIF images stored in Photos Library as well. Just use the same API as normal images to query the asset. We will query the image data and decode the animated images (compatible with <code>UIImageView</code> as well as <a href="https://github.com/rs/SDWebImage/wiki/Advanced-Usage#animated-image-50">SDAnimatedImageView</a>)</p>
<h4 id='video-asset' class='heading'>Video Asset</h4>

<p>SDWebImagePhotosPlugin supports to load Video Asset poster as well. By default we don&rsquo;t allow non-image type asset, to avoid the accidentally pick of wrong Asset. But you can disable this limit as well.</p>

<ul>
<li>Objective-C</li>
</ul>
<pre class="highlight plaintext"><code>SDWebImagePhotosLoader.sharedLoader.requestImageAssetOnly = NO;
</code></pre>

<ul>
<li>Swift</li>
</ul>
<pre class="highlight swift"><code><span class="kt">SDWebImagePhotosLoader</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">requestImageAssetOnly</span> <span class="o">=</span> <span class="kc">false</span>
</code></pre>

<p>Then just request the PHAssets or using the fetch options, which the media type is <code>.video</code>.</p>
<h4 id='fetch-request-options' class='heading'>Fetch/Request Options</h4>

<p>To specify options like <code>PHFetchOptions</code> or <code>PHImageRequestOptions</code> for Photos Library. Either to change the correspond properties in loader, or provide a context options for each image request.</p>

<ul>
<li>Objective-C</li>
</ul>
<pre class="highlight plaintext"><code>// loader-level options
// ignore iCloud Shared Album (`localIdentifier` Photos URL only)
PHFetchOptions *fetchOptions = [PHFetchOptions new];
fetchOptions.predicate = [NSPredicate predicateWithFormat:@"sourceType != %d", PHAssetSourceTypeCloudShared];
SDWebImagePhotosLoader.sharedLoader.fetchOptions = fetchOptions;

// request-level options
// allows iCloud Photos Library
PHImageRequestOptions *requestOptions = [PHImageRequestOptions new];
requestOptions.networkAccessAllowed = YES;
[imageView sd_setImageWithURL:photosURL placeholderImage:nil context:@{SDWebImageContextPhotosImageRequestOptions: requestOptions, SDWebImageContextCustomManager: manager}];
</code></pre>

<ul>
<li>Swift</li>
</ul>
<pre class="highlight swift"><code><span class="c1">// loader-level options</span>
<span class="c1">// ignore iCloud Shared Album (`localIdentifier` Photos URL only)</span>
<span class="k">let</span> <span class="nv">fetchOptions</span> <span class="o">=</span> <span class="kt">PHFetchOptions</span><span class="p">()</span>
<span class="n">fetchOptions</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="kt">NSPredicate</span><span class="p">(</span><span class="nv">format</span><span class="p">:</span> <span class="s">"sourceType != %d"</span><span class="p">,</span> <span class="kt">PHAssetSourceType</span><span class="o">.</span><span class="n">typeCloudShared</span><span class="o">.</span><span class="n">rawValue</span><span class="p">)</span>
<span class="kt">SDWebImagePhotosLoader</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">fetchOptions</span> <span class="o">=</span> <span class="n">fetchOptions</span>

<span class="c1">// request-level options</span>
<span class="c1">// allows iCloud Photos Library</span>
<span class="k">let</span> <span class="nv">requestOptions</span> <span class="o">=</span> <span class="kt">PHImageRequestOptions</span><span class="p">()</span>
<span class="n">requestOptions</span><span class="o">.</span><span class="n">networkAccessAllowed</span> <span class="o">=</span> <span class="kc">true</span>
<span class="n">imageView</span><span class="o">.</span><span class="nf">sd_setImage</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">photosURL</span><span class="p">,</span> <span class="nv">placeholderImage</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">context</span><span class="p">:[</span><span class="o">.</span><span class="nv">photosImageRequestOptions</span><span class="p">:</span> <span class="n">requestOptions</span><span class="p">,</span> <span class="o">.</span><span class="nv">customManager</span><span class="p">:</span> <span class="n">manager</span><span class="p">])</span>
</code></pre>
<h2 id='tips' class='heading'>Tips</h2>
<div class="aside aside-since">
    <p class="aside-title">Since</p>
    Since Photos Library image is already stored on the device disk. And query speed is fast enough for small resolution image. You can use <code>SDWebImageContextStoreCacheType</code> with <code>SDImageCacheTypeNone</code> to disable cache storage. And use <code>SDWebImageFromLoaderOnly</code> to disable cache query.

</div>
<li>If you use <code>PHImageRequestOptionsDeliveryModeOpportunistic</code> (by default) to load the image, PhotosKit will return a degraded thumb image firstly and again with the full pixel image. When the image is degraded, the loader completion block will set <code>finished = NO</code>. But this will not trigger the View Category completion block, only trigger a image refresh (like progressive loading behavior for network image using <code>SDWebImageProgressiveLoad</code>)</li>
<li>By default, we will prefer using Photos <a href="https://developer.apple.com/documentation/photokit/phimagemanager/1616964-requestimageforasset?language=objc">requestImageForAsset:targetSize:contentMode:options:resultHandler:</a> API for normal images, using <a href="https://developer.apple.com/documentation/photokit/phimagemanager/1616957-requestimagedataforasset?language=objc">requestImageDataForAsset:options:resultHandler:</a> for animated images like GIF asset. If you need the raw image data for further image processing, you can always pass <code>SDWebImageContextPhotosRequestImageData</code> context option to force using the request data API instead. Note when request data, the <code>targetSize</code> and <code>contentMode</code> options are ignored. If you need smaller image size, consider using <a href="https://github.com/SDWebImage/SDWebImage/wiki/Advanced-Usage#image-transformer-50">Image Transformer</a> feature from SDWebImage 5.0</li>
<h2 id='warning' class='heading'>Warning</h2>

<p>The Photos taken by iPhone&rsquo;s Camera, its pixel size may be really large (4K+). So if you want to load large Photos Library assets for rendering, you&rsquo;d better specify target size with a limited size (like you render imageView&rsquo;s size).</p>

<p>By default, we query the target size matching the original image pixel size (See: <code><a href="Constants.html#/c:@SDWebImagePhotosLoaderPixelSize">SDWebImagePhotosLoaderPixelSize</a></code>), which may consume much memory on iOS device.</p>
<h2 id='demo' class='heading'>Demo</h2>

<p>If you have some issue about usage, SDWebImagePhotosPlugin provide a demo for iOS &amp;&amp; macOS platform. To run the demo, clone the repo and run the following command.</p>
<pre class="highlight shell"><code><span class="nb">cd </span>Example/
pod install
open SDWebImagePhotosPlugin.xcworkspace
</code></pre>

<p>After the Xcode project was opened, click <code>Run</code> to build and run the demo.</p>
<h2 id='author' class='heading'>Author</h2>

<p>DreamPiggy, <a href="mailto:lizhuoli1126@126.com">lizhuoli1126@126.com</a></p>
<h2 id='license' class='heading'>License</h2>

<p>SDWebImagePhotosPlugin is available under the MIT license. See the LICENSE file for more info.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2019 <a class="link" href="https://github.com/SDWebImage/SDWebImagePhotosPlugin" target="_blank" rel="external">SDWebImagePhotosPlugin</a>. All rights reserved. (Last updated: 2019-11-18)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.11.2</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
